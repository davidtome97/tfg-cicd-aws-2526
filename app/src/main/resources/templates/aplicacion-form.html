<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${aplicacion.id} != null ? 'Editar aplicación' : 'Nueva aplicación'">
        Nueva aplicación
    </title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">

<h2 class="mb-4"
    th:text="${aplicacion.id} != null ? 'Editar aplicación' : 'Nueva aplicación'">
    Nueva aplicación
</h2>

<form th:action="@{/aplicaciones/guardar}" th:object="${aplicacion}" method="post">

    <input type="hidden" th:field="*{id}"/>

    <!-- Sección Datos generales -->
    <div class="card mb-3">
        <div class="card-header">Datos generales</div>
        <div class="card-body">

            <div class="mb-3">
                <label class="form-label">Nombre de la aplicación</label>
                <input type="text" class="form-control" th:field="*{nombre}" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Descripción</label>
                <textarea class="form-control" th:field="*{descripcion}" rows="3"></textarea>
            </div>

            <!-- SOLO se muestra si estamos editando una aplicación existente -->
            <div class="mb-3" th:if="${aplicacion.id} != null">
                <label class="form-label">Fecha de creación</label>
                <input type="text"
                       class="form-control"
                       th:value="${#temporals.format(aplicacion.fechaCreacion, 'dd/MM/yyyy HH:mm')}"
                       readonly>
            </div>

        </div>
    </div>

    <!-- Sección Tecnología -->
    <div class="card mb-3">
        <div class="card-header">Tecnología</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label d-block">Lenguaje</label>
                <div class="form-check form-check-inline"
                     th:each="len : ${lenguajes}">
                    <input class="form-check-input"
                           type="radio"
                           th:field="*{lenguaje}"
                           th:value="${len}">
                    <label class="form-check-label"
                           th:for="${#ids.prev('lenguaje')}"
                           th:text="${len}">
                        JAVA
                    </label>
                </div>
            </div>

            <!-- Tipo de proyecto: por ahora solo informativo -->
            <div class="mb-3">
                <label class="form-label d-block">Tipo de proyecto</label>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="tipoProyecto"
                           value="config" checked>
                    <label class="form-check-label">Solo configuración</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="tipoProyecto"
                           value="demo">
                    <label class="form-check-label">Demo app (opcional)</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección Base de datos -->
    <div class="card mb-3">
        <div class="card-header">Base de datos</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Tipo de base de datos</label>
                <select class="form-select" th:field="*{tipoBaseDatos}">
                    <option th:each="tipo : ${tiposBaseDatos}"
                            th:value="${tipo}"
                            th:text="${tipo}">
                    </option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Nombre BD</label>
                <input type="text" class="form-control" th:field="*{nombreBaseDatos}">
            </div>

            <div class="mb-3">
                <label class="form-label">Usuario BD</label>
                <input type="text" class="form-control" th:field="*{usuarioBaseDatos}">
            </div>

            <div class="mb-3">
                <label class="form-label">Password BD</label>
                <input type="password" class="form-control" th:field="*{passwordBaseDatos}">
            </div>
        </div>
    </div>

    <!-- Sección CI/CD -->
    <div class="card mb-3">
        <div class="card-header">CI/CD</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Proveedor</label>
                <select class="form-select" th:field="*{proveedorCiCd}">
                    <option th:each="prov : ${proveedoresCiCd}"
                            th:value="${prov}"
                            th:text="${prov}">
                    </option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Repositorio Git</label>
                <input type="text" class="form-control" th:field="*{repositorioGit}"
                       placeholder="https://github.com/usuario/proyecto.git">
            </div>

            <div class="mb-3">
                <label class="form-label">Sonar Project Key</label>
                <input type="text" class="form-control" th:field="*{sonarProjectKey}">
            </div>
        </div>
    </div>

    <!-- Sección Despliegue -->
    <div class="card mb-3">
        <div class="card-header">Despliegue</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Puerto interno de la app</label>
                <input type="number" class="form-control" th:field="*{puertoAplicacion}">
            </div>

            <div class="mb-3">
                <label class="form-label">Nombre imagen ECR (opcional)</label>
                <input type="text" class="form-control" th:field="*{nombreImagenEcr}">
                <small class="form-text text-muted">
                    Si lo dejas vacío se podrá autogenerar más adelante.
                </small>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-between">
        <a th:href="@{/aplicaciones}" class="btn btn-secondary">Volver</a>

        <div>
            <button type="submit" class="btn btn-primary">Guardar</button>
            <!-- De momento este botón hace lo mismo; luego lo conectaremos con el motor ZIP -->
            <button type="submit" class="btn btn-success ms-2" name="accion" value="guardar_y_zip">
                Guardar y generar ZIP
            </button>
        </div>
    </div>

</form>

</body>
</html>