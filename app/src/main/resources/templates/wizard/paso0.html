<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Paso 0 – Primer commit</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- appId disponible en JS si lo necesitas -->
    <meta name="appId" th:content="${appId}">
</head>

<body class="bg-light">

<div class="container mt-3">
    <div class="d-flex justify-content-end mb-3">
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="btn btn-outline-danger">
                Cerrar sesión
            </button>
        </form>
    </div>
</div>

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/aplicaciones}">Sistema CI/CD – Paso 0</a>
    </div>
</nav>

<div class="container">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Paso 0 – Inicializar repositorio (primer commit)</h2>

        <!-- PDF que vas a meter en /manuales -->
        <a href="/manuales/paso_0.pdf" target="_blank"
           class="btn btn-outline-secondary btn-sm">
            Ver guía de este paso
        </a>
    </div>

    <p class="text-muted">
        Antes de empezar el asistente, debes crear el repositorio remoto y hacer el primer commit.
        Este paso asegura que existe historial en Git y que el pipeline podrá trabajar sobre una rama principal.
    </p>

    <div class="card p-4 shadow-sm">

        <div class="mb-3">
            <h5 class="mb-2">Comandos sugeridos</h5>
            <div class="alert alert-secondary mb-0">
<pre class="mb-0">
git init
git add .
git commit -m "initial commit"
git branch -M main
git remote add origin &lt;URL_DEL_REPO&gt;
git push -u origin main
</pre>
            </div>
            <div class="form-text">
                Si ya tenías repo, asegúrate de que existe al menos un commit en la rama principal (<code>main</code>).
            </div>
        </div>

        <hr>

        <!-- Form para marcar OK (guarda opcionalmente hash del commit) -->
        <form th:action="@{/wizard/paso0/confirmar}" method="post">
            <input type="hidden" name="appId" th:value="${appId}"/>

            <div class="mb-3">
                <label class="form-label" for="commitHash">Hash del commit (opcional)</label>
                <input id="commitHash" name="commitHash" class="form-control"
                       placeholder="Ej: 37e8959a3de9f24dd9751e9f135c8feeb6c036d7">
                <div class="form-text">
                    Opcional, pero recomendable para auditoría. Puedes verlo con <code>git log --oneline -1</code>.
                </div>
            </div>

            <button type="submit" class="btn btn-primary">
                Ya he hecho el primer commit → Continuar
            </button>
        </form>

        <hr>

        <!-- ESTADO inicial desde BD (controlPaso) -->
        <p class="mt-3 fs-5">
            Estado:
            <span id="estado"
                  class="badge bg-secondary"
                  th:text="${controlPaso != null ? controlPaso.estado : 'PENDIENTE'}">
                PENDIENTE
            </span>
        </p>

        <p id="mensaje" class="text-muted mb-0"
           th:text="${controlPaso != null ? controlPaso.mensaje : ''}"></p>
    </div>

    <div class="mt-3 d-flex justify-content-between">
        <a th:href="@{/aplicaciones}" class="btn btn-link">&larr; Volver al listado</a>
        <!-- Si quieres forzar el flujo: cuando esté OK, entrarás con el POST; este link es solo por navegación -->
        <a th:href="@{/wizard/paso1(appId=${appId})}" class="btn btn-link">volver al paso 1 →</a>
    </div>

</div>

<script>
    // Pintar color al cargar (según lo que venga de BD)
    (function pintarEstadoInicial(){
        const badge = document.getElementById("estado");
        if (!badge) return;
        const estado = (badge.textContent || "").trim();

        if (estado === "OK") badge.className = "badge bg-success";
        else if (estado === "KO") badge.className = "badge bg-danger";
        else badge.className = "badge bg-secondary";
    })();
</script>

</body>
</html>